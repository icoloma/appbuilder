<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no">
  <link rel="stylesheet" href="/bower_components/qunit/qunit/qunit.css">
</head>
<body>


  <script src="/js/config/require.conf.js"></script>
  <script src="/bower_components/qunit/qunit/qunit.js"></script>
  <script src="lib/test.js"></script>
  <script src="/js/lib/components/requirejs/require.js"></script>
  <script>
    require(['poi/model'], function(Poi) {
      QUnit.start();

      var schema = {
        someField: 'TEXT',
        name: 'i18n',
        funny: 'BOOLEAN',
        stuff: 'JSON',
        lat: 'REAL',
        lon: 'REAL',
      }
      , poiData = {
        someField: 'lorem ipsum',
        name_es: 'foobar es',
        name_en: 'foobar en',
        name_jp: 'foobar jp',
        funny: 0,
        stuff: '{"someStuff":"some value"}',
        lat: 40,
        lon: 0.5,
        normLon: 0.32
      }
      ;

      Poi.initSchema(schema);

      test('Conversión desde SQL', 2, function() {
        var poi = new Poi(poiData, {parse: true});
        
        equal(poi.get('funny'), !!poiData.funny, 'INTEGER->BOOLEAN');
        deepEqual(poi.get('stuff'), JSON.parse(poiData.stuff), 'TEXT->JSON');
      });

      test('Conversión a SQL', 2, function() {
        var row = (new Poi(poiData, {parse: true})).toRow();

        equal(row.funny, poiData.funny, 'BOOLEAN->INTEGER');
        equal(row.stuff, poiData.stuff, 'JSON->TEXT');
      });

      // TO-DO: test de persistencia
    });
  </script>

  <div id="qunit"></div>
</body>
</html>